================================================================
NotioClass 개발 일지 - 2026년 1월 10일
================================================================

작업 내용: AI 파이프라인 최적화 시도 (실패)


----------------------------------------------------------------
1. AI 파이프라인 최적화 시도 (3단계 -> 2단계)
----------------------------------------------------------------

배경:
  - 기존 파이프라인: 3번 API 호출 -> ~110초 소요
    - Step 0: OCR 정제 (GPT-5-mini) ~35초
    - Step 1: 구조 분석 (GPT-5-mini) ~35초
    - Step 2: 콘텐츠 생성 (GPT-5-mini) ~35초
  - 목표: 2번 API 호출 -> ~70초

시도한 방법:
  - Step 1 + Step 2를 하나의 API 호출로 통합
  - 구조 분석과 콘텐츠 생성을 한 번에 수행

구현 내용:

[새 메서드: _step1_analyze_and_organize]
  - 하나의 프롬프트로 분석 + 정리 동시 수행
  - JSON 형식으로 subject, note_type, detected_unit, content 반환
  - max_completion_tokens: 8000 (기존 Step1 3000 + Step2 6000 통합)

[organize_note 메서드 수정]
  - 기본 요약(BASIC_SUMMARY), 코넬식(CORNELL): 최적화된 2단계 사용
  - 오답노트(ERROR_NOTE), 단어장(VOCAB): 기존 3단계 유지

[새 메서드: _organize_note_legacy]
  - 기존 3단계 로직을 별도 메서드로 분리
  - 오답노트/단어장 처리용


----------------------------------------------------------------
2. Railway 테스트 결과 (실패)
----------------------------------------------------------------

로그 타임스탬프 분석:
  12:06:02 - Starting optimized AI pipeline
  12:06:02 - [AI] 0단계: OCR 정제 시작...
  12:06:49 - [AI] 0단계 완료 (47초 소요)
  12:06:49 - [AI] 1+2단계 통합: 분석 및 정리 시작...
  12:08:19 - [AI] Step 1+2 API 완료 (90초 소요)
  12:08:49 - [43] Processing completed

실측 시간:
  - Step 0 (OCR 정제): 47초
  - Step 1+2 (통합): 90초
  - Concept Card 추출: 30초
  - 총합: ~2분 47초

비교:
  - 최적화 전 (3단계): ~110초
  - 최적화 후 (2단계): ~137초
  - 결과: 오히려 27초 더 느려짐 ❌


----------------------------------------------------------------
3. 실패 원인 분석
----------------------------------------------------------------

1. 프롬프트 복잡도 증가
   - Step 1+2 통합 프롬프트가 분석 + 정리를 한꺼번에 요구
   - 모델이 더 많이 "생각"하면서 응답 시간 증가

2. 토큰 사용량 증가
   - max_completion_tokens 8000 설정
   - 복잡한 JSON 출력 요구로 토큰 사용량 증가

3. API 호출 횟수 vs 호출당 시간
   - 호출 횟수는 줄었지만 (3회 -> 2회)
   - 호출당 시간이 크게 증가 (35초 -> 90초)


----------------------------------------------------------------
4. 커밋 내역
----------------------------------------------------------------

작업 브랜치: main (직접 커밋)
커밋 목록:
  1. perf: AI 파이프라인 최적화 (3단계 -> 2단계)
  2. fix: 불필요한 재처리 로직 제거
  3. fix: process.py에서 최적화된 파이프라인 사용


----------------------------------------------------------------
5. 다음 단계 검토 필요
----------------------------------------------------------------

선택지:
  [ ] 롤백: 기존 3단계로 복원 (~110초)
  [ ] 프롬프트 최적화: 통합 프롬프트 간소화
  [ ] 병렬 처리: Step 0 완료 후 Step 1, Step 2 동시 실행
  [ ] 모델 변경: GPT-5-nano 사용 (품질 저하 우려)

결론:
  - API 호출 횟수 줄이기 != 속도 개선
  - 프롬프트 복잡도가 응답 시간에 큰 영향


================================================================
