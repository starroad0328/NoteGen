================================================================
NotioClass 개발 일지 - 2026년 1월 7~8일
================================================================

작업 내용: OCR 버그 수정 + 역사 과목 문제 생성 기능


----------------------------------------------------------------
1. OCR 서비스 Cloudinary URL 처리 버그 수정
----------------------------------------------------------------

문제:
  - Cloudinary URL로 저장된 이미지 OCR 처리 시 오류 발생
  - "이미지 파일을 찾을 수 없습니다" 에러 메시지

원인:
  - OCR 서비스가 로컬 파일 경로만 처리하고 URL은 처리하지 못함
  - URL을 로컬 파일처럼 os.path.exists()로 체크하여 실패

해결:
  - URL인 경우 httpx로 이미지 다운로드
  - 임시 파일로 저장 후 OCR 처리
  - try-finally로 임시 파일 자동 정리

수정 파일:
  - backend/app/services/ocr_service.py


----------------------------------------------------------------
2. 역사 과목 문제 생성 기능 (MVP)
----------------------------------------------------------------

구현 내용:
  - Question 모델: 문제 텍스트, 선택지, 정답, 해설, 인지 단계
  - UserQuestionAttempt 모델: 풀이 기록, 정답 여부, 오류 유형
  - history_question.txt: 역사 전용 AI 프롬프트
  - generate_history_questions_from_note(): 노트 기반 문제 생성

인지 단계별 문제 유형:
  - recall: 단순 회상 (용어, 사실)
  - sequence: 순서/연대 (사건 순서)
  - cause_effect: 인과관계 (원인-결과)
  - compare: 비교 (유사점/차이점)

오류 유형 태그:
  - term_confusion: 용어 혼동
  - chronology_confusion: 연대 혼동
  - cause_effect_mixup: 인과관계 뒤바꿈
  - comparison_miss: 비교 포인트 누락

수정 파일:
  - backend/app/models/question.py (신규)
  - backend/app/prompts/history_question.txt (신규)
  - backend/app/services/ai_service.py
  - backend/app/api/questions.py (신규)


----------------------------------------------------------------
3. 문제 탭 UI 구현
----------------------------------------------------------------

구현 내용:
  - 5탭에서 문제 탭 추가 (홈/노트/업로드/문제/MY)
  - 노트 선택 모달: 역사 노트 필터링
  - 노트별 문제 그룹화: 제목 + 문제 개수 뱃지
  - 전체 삭제 버튼

UX 개선:
  - 듀오링고 스타일: 문제 생성 후 바로 풀이 화면 이동
  - Alert 없이 매끄러운 전환

수정 파일:
  - mobile/app/(tabs)/questions.tsx (신규)
  - mobile/app/(tabs)/_layout.tsx
  - mobile/app/questions/[noteId].tsx (신규)
  - mobile/services/api.ts


----------------------------------------------------------------
4. 버그 수정
----------------------------------------------------------------

FastAPI 라우트 순서:
  - 문제: /{question_id}가 /stats/summary, /weak-practice 앞에 있어
    422 Unprocessable Content 오류 발생
  - 해결: 구체적인 경로를 패턴 경로보다 먼저 정의

GPT-5 temperature 파라미터:
  - 문제: GPT-5 모델은 temperature != 1 지원 안 함
  - 해결: temperature=0.7 파라미터 제거

API 타임아웃:
  - 문제: 문제 생성에 30초 이상 소요되어 Network Error
  - 해결: axios 타임아웃 60초로 증가


----------------------------------------------------------------
커밋 내역
----------------------------------------------------------------

a0f9481 fix: OCR 서비스 Cloudinary URL 처리 버그 수정
900020a feat: 문제 생성 후 바로 풀이 화면 이동 + 전체 삭제 API
dc9456f feat: 문제 탭 개선 - 노트별 그룹화 + 전체 삭제 버튼


================================================================
