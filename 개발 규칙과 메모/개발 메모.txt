═══════════════════════════════════════════════════════════════
                    NotioClass 개발 메모
═══════════════════════════════════════════════════════════════

최종 업데이트: 2026년 1월 8일


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 현재 상태
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

진행도: 100% (핵심 기능 완료)

완료된 작업:
  ✅ 프로젝트 기획 및 문서화
  ✅ Backend API 구현 (FastAPI)
  ✅ Mobile App UI 구현 (React Native + Expo)
  ✅ AI 모델 가격 정책 수립
  ✅ 데이터베이스 모델 설계
  ✅ CLOVA OCR API 통합 (네이버 클라우드)
  ✅ OCR bbox + confidence 메타데이터 저장
  ✅ Expo SDK 54 업그레이드
  ✅ 백엔드-모바일 연동 테스트
  ✅ GPT-5 mini AI 정리 통합
  ✅ OpenAI API 연동 완료
  ✅ 3단계 AI 파이프라인 구현 (OCR정제 → 구조파악 → 정리)
  ✅ OCR 블록 압축 (토큰 절약)
  ✅ 폴링 에러 처리 개선
  ✅ OCR 정제 LLM (GPT-5 nano) 추가
  ✅ AI 단계별 진행 상태 표시
  ✅ 노트 복사 버튼 추가

완료된 추가 작업:
  ✅ 로그인/회원가입 기능 (JWT 인증)
  ✅ 학년 선택 UI (중/고 1~3학년)
  ✅ 교육과정 데이터 (2022 개정 기준)
  ✅ AI 프롬프트에 학년/교육과정 반영
  ✅ 교육과정 DB 스키마 설계 (Subject, Domain, AchievementStandard)
  ✅ 중학교 수학 성취기준 61개 입력 (2015 개정)
  ✅ 중학교 국어 성취기준 44개 입력 (2015 개정)
  ✅ 중학교 영어 성취기준 28개 입력 (2015 개정)
  ✅ 중학교 사회 성취기준 62개 입력 (2015 개정)
  ✅ 중학교 과학 성취기준 45개 입력 (2015 개정)
  ✅ 노트 상세 화면 UI 개선 (섹션 카드 + 목차 드로어)
  ✅ 보관함 썸네일 그리드 뷰
  ✅ 노트 삭제 기능
  ✅ 오답노트/단어장 정리 방식 추가
  ✅ 과목/노트타입 자동 감지 (수학, 영어, 국어 등)
  ✅ Google Vision OCR 통합 (오답노트용 수학 기호 인식)
  ✅ 코넬식 노트 줌 캔버스 UI (Google Docs 스타일) -> 단일 컬럼으로 변경
  ✅ AI 출력 JSON 구조화 (코넬식)
  ✅ 키워드 암기용 형식 개선
  ✅ 노트 재처리 API 추가
  ✅ 월간 사용량 제한 시스템 (Free 10회, Basic 100회, Pro 무제한)
  ✅ 5탭 네비게이션 (홈/노트/업로드/문제/MY)
  ✅ 통합 단일 컬럼 노트 UI (블록 타입 시스템)
  ✅ 오답노트 마크다운 패턴 자동 인식
  ✅ 사용량 표시 UI (홈/업로드/MY 탭)
  ✅ Google Play 인앱결제 시스템
  ✅ NotioClass 리브랜딩 (앱 이름 변경, 에셋 교체)
  ✅ 홈 화면 NotioClass 테마 적용
  ✅ 테마 시스템 구현 (흰색/다크/갈색/살구색 4가지)
  ✅ 설정 화면 신규 생성 (앱 설정, 필기 정리 설정, 플랜 관리)
  ✅ 모든 탭 화면에 동적 테마 적용
  ✅ AI 1단계에 학년 정보 활용 (단원 감지 추가)
  ✅ Pro 개인화 시스템 - 취약 개념 추적
  ✅ 보관함 과목 필터 및 자동 제목 생성 기능
  ✅ 수학 오답노트 검산 단계 추가
  ✅ 노트 상세 화면 테마 색상 적용
  ✅ 업로드 네트워크 오류 해결 (axios→fetch)
  ✅ Railway 클라우드 서버 배포
  ✅ PostgreSQL 데이터베이스 (Railway)
  ✅ 로컬 서버 없이 핸드폰에서 테스트 가능
  ✅ Cloudinary 이미지 저장소 연동
  ✅ 정리법샵 MVP (템플릿 구독/좋아요/적용)
  ✅ 요약 노트 생성 기능 (GPT-5.2)
  ✅ 반응형 Safe Area 적용
  ✅ 관리자 플랜 변경 API
  ✅ 역사 과목 문제 생성 기능 (GPT-5)
  ✅ 문제 탭 추가 (노트별 그룹화)
  ✅ 듀오링고 스타일 문제 풀이 UX
  ✅ 2022 개정 교육과정 성취기준 추가 (중3 94개 + 고1 116개 = 210개)

현재 브랜치: main
앱 이름: NotioClass (구 NoteGen)
서버 URL: https://notegen-production.up.railway.app


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 MVP 출시 우선순위
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[우선순위 1] 필수 - 스토어 출시 요건
  ✅ 월간 사용량 제한 (무료 10회/월) - 완료
  ✅ 사용량 표시 UI - 완료
    - 홈: "N회 남음" 알약 배지 (3회 이하 경고색)
    - 업로드: "N/M회" 배지 (0회 빨간색)
    - MY: 프로그레스 바 + 상세 사용량
    - 초과 시 친근한 업그레이드 팝업
  ✅ 앱 스토어 에셋 - 임시 완료 (추후 디자인 교체 예정)
    - icon.png (1024x1024) - 노트+연필 아이콘
    - adaptive-icon.png - Android 적응형
    - splash.png (1284x2778) - 로고+태그라인
    - favicon.png (48x48)
  □ 스토어 스크린샷 (출시 전 촬영)
  □ 플랜 기능 구현
    - 티어별 AI 모델 분기 (Free: nano, Basic: mini, Pro: 5.2)
    - Google Play Console 상품 등록 (notioclass_basic_monthly 등)
    - 실제 구매 검증 API 연동

[우선순위 2] 결제 시스템 (수익화)
  ✅ Google Play 결제 연동 - 완료
    - react-native-iap 라이브러리
    - 백엔드 구매 검증 API
    - upgrade.tsx 결제 UI
  ✅ 구독 상태 관리 (Free/Basic/Pro) - 완료
    - Subscription, Payment 모델
    - 구독 취소/복원 API
  □ 티어별 AI 모델 분기 (TODO)
    - Free: GPT-5 nano
    - Basic: GPT-5 mini
    - Pro: GPT-5.2
  □ Google Play Console 설정 (TODO)
    - 상품 등록 (notegen_basic_monthly 등)
    - 서비스 계정 키 발급

[우선순위 3] 정리법샵 MVP (핵심 차별화) ✅ 완료
  ✅ 정리법 = Prompt + Structure + Features
  ✅ 정리법 리스트/상세 화면
    - 과목 필터, 정렬 (최신/인기)
    - 필요 플랜 배지 (Free/Basic/Pro)
  ✅ 정리탭 연동
    - 업로드 화면에서 구독한 정리법 선택
    - 정리법 프롬프트 적용
  ✅ 구독/좋아요 기능
    - 정리법 구독 및 즐겨찾기
    - 상세 모달에서 프롬프트 확인
  □ 정리법 생성/업로드 (V2)
    - 프롬프트: 직접 작성 / 선택형 조합
    - 구조: 요약형 / 단어장형 / 비교표
    - 썸네일 설정

[우선순위 4] 추가 기능 (V2)
  ✅ 추가 템플릿 (오답노트, 단어장) - 완료
  □ 성취기준 매핑 파이프라인
  □ 시험 대비 모드 (Pro)
  □ 정리법샵 확장 (캔버스 에디터, 랭킹, 수익 분배)


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 다음 세션 시작 전 필요사항
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

필수:
  ✅ CLOVA OCR API 설정 완료
    → Secret Key, Invoke URL 설정됨

  □ OpenAI API Key 발급 (AI 정리 기능용)
    → https://platform.openai.com/api-keys
    → backend/.env에 OPENAI_API_KEY 입력 필요

선택:
  □ Google Cloud Vision API (이중 OCR용)
  □ Android Studio (에뮬레이터 테스트)


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 빠른 실행 명령어
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Backend 실행:
  cd backend
  pip install -r requirements.txt
  uvicorn app.main:app --reload --host 0.0.0.0
  → http://localhost:8000/docs (LAN: http://192.168.55.96:8000)

Mobile App 실행:
  cd mobile
  npm install

  [Windows CMD]
  set REACT_NATIVE_PACKAGER_HOSTNAME=192.168.55.96 && npm run start -- --lan

  [PowerShell]
  $env:REACT_NATIVE_PACKAGER_HOSTNAME="192.168.55.96"; npm run start -- --lan

  → Expo Go 앱으로 QR 스캔 (LAN IP로 접속)
  → 환경변수 설정 안 하면 localhost로 뜸 (모바일 접속 불가)


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 알려진 이슈
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. OCR 이중 구성
   - 기본: CLOVA OCR (한글 손글씨 최적)
   - 오답노트: Google Vision (수학 기호 인식 향상)

2. OCR 메타데이터 저장
   - bbox, confidence 정상 저장됨 (JSON 형식)
   - 이중 JSON 인코딩 이슈 해결됨

3. Expo SDK 54 사용
   - expo-linking 추가 설치 필요
   - React Native 0.81.5, React 19.1.0

4. Windows 인코딩 이슈
   - emoji 제거로 해결
   - cp949 codec 에러 방지


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 최근 개발 내역 (2025-12-21 저녁)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 노트 상세 화면 UI 전면 개편
  - 마크다운을 섹션(#, ##)별로 파싱
  - 각 섹션을 카드 형태로 표시
  - 섹션 타입별 아이콘/색상 자동 적용
    - 핵심(🔑 빨강), 요약(📌 주황), 개념(💡 파랑)
    - 설명(📝 초록), 예시(✏️ 보라), 시험(🎯 오렌지)
  - 목차 드로어 추가 (탭하면 해당 섹션으로 스크롤)

✅ 백엔드 API 업데이트
  - image_urls 필드 추가 (원본 이미지 URL 목록)
  - 정적 파일 서빙 (/uploads)

✅ 탭 네비게이션 구조 정리
  - (tabs) 폴더로 이동: index, notes, profile
  - 기존 중복 파일 삭제


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 현재 AI 파이프라인
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

이미지 업로드
    ↓
OCR (기본: CLOVA / 오답노트: Google Vision)
    ↓
0단계: OCR 정제 (GPT-5 nano, 3000 토큰)
    ↓
1단계: 구조 파악 + 과목/타입/단원 감지 (GPT-5 mini, 3000 토큰)
       - 학년 정보 활용 (school_level, grade)
       - 교육과정 기반 단원 감지 (detected_unit)
    ↓
2단계: 타입별 프롬프트로 정리 생성 (GPT-5 mini, 6000 토큰)
       - 학년별 교육과정 컨텍스트 적용
    ↓
결과 반환 (content, subject, note_type, unit)

[TODO] 다음 단계: 성취기준 매핑 파이프라인 추가
    - 필기 내용 → 성취기준 코드 매핑
    - 학년/과목별 관련 성취기준 표시
    - ✅ 전 과목 성취기준 데이터 완료 (수학 61 + 국어 44 + 영어 28 + 사회 62 + 과학 45 = 총 240개)


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 GitHub 정보
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

저장소: https://github.com/starroad0328/NoteGen
브랜치: main
최신 커밋: 76730a6 (feat: Google Play 인앱결제 시스템 구현)


═══════════════════════════════════════════════════════════════


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 AI 프롬프트 원본 (백업)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[ 기본 요약 정리 프롬프트 - 원본 (GPT-5/5-mini용) ]

다음 필기 내용을 '기본 요약 정리' 형식으로 정리해주세요.

[정리 규칙]
1. 제목을 자동으로 생성하세요 (내용을 기반으로)
2. 소제목으로 내용을 구분하세요
3. 각 소제목 아래에 글머리표(•)를 사용하여 요약하세요
4. 중요한 개념은 ⭐ 표시를 추가하세요
5. 강조할 내용은 🔸 표시를 추가하세요
6. 마크다운 형식으로 작성하세요

[출력 형식]
# [제목]

## [소제목 1]
• 요약 내용 1
• ⭐ 중요 개념
• 요약 내용 2

## [소제목 2]
• 🔸 강조 내용
• 요약 내용

[필기 원문]
{ocr_text}

위 내용을 기본 요약 정리 형식으로 정리해주세요:


[ 코넬식 정리 프롬프트 - 원본 (GPT-5/5-mini용) ]

다음 필기 내용을 '코넬식 노트' 형식으로 정리해주세요.

[정리 규칙]
1. 제목을 자동으로 생성하세요
2. 좌측 키워드: 핵심 개념을 질문형으로 ("~란?", "~의 특징은?")
3. 우측 본문: 개념을 명확하게 설명
4. 하단 요약: 전체 내용을 1문장으로 압축
5. 중요한 개념은 ⭐ 표시
6. 마크다운 형식으로 작성하세요

[출력 형식]
# [제목]

## 📝 노트 내용

| 키워드/질문 | 설명 |
|------------|------|
| ⭐ [핵심 개념]이란? | [명확한 설명] |
| [관련 개념]의 특징은? | [특징 설명] |

---

**📌 요약**
[전체 내용을 1문장으로 압축한 요약]

[필기 원문]
{ocr_text}

위 내용을 코넬식 노트 형식으로 정리해주세요:


═══════════════════════════════════════════════════════════════


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 작업 종료 메모 (2026-01-08)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

※ 상세 개발 내역은 "개발 일지/" 폴더 참조

오늘 완료한 작업:
  ✅ 2022 개정 교육과정 성취기준 추가
    - 중학교: 수학 중3 15개 + 국어 45개 + 영어 34개
    - 고등학교: 공통수학 37개 + 통합사회 29개 + 통합과학 28개 + 한국사 22개
    - 총 210개 성취기준 추가

  ✅ 역사 과목 문제 생성 기능 구현
    - Question, UserQuestionAttempt 모델
    - 노트 기반 4지선다 문제 생성 (GPT-5)
    - 인지 단계별 문제 유형 (recall, sequence, cause_effect, compare)
    - 오류 유형 태깅 (term_confusion, chronology_confusion 등)

  ✅ 문제 탭 UI 구현
    - 노트 선택 → 문제 생성 흐름
    - 노트별 문제 그룹화 (N개의 문제 뱃지)
    - 전체 삭제 버튼
    - 듀오링고 스타일: 생성 후 바로 풀이 화면 이동

  ✅ 문제 풀이 화면
    - 4지선다 UI
    - 정답/오답 피드백 + 해설
    - 진행률 표시

현재 상태:
  - 앱 이름: NotioClass
  - 서버: Railway 클라우드 (https://notegen-production.up.railway.app)
  - 데이터베이스: Railway PostgreSQL
  - 이미지 저장: Cloudinary
  - OCR: CLOVA (기본) + Google Vision (오답노트)
  - AI: 3단계 파이프라인 + 요약 생성 (GPT-5.2) + 문제 생성 (GPT-5)
  - 정리법샵: 템플릿 구독/좋아요/프롬프트 적용
  - 요약 노트: 플랜별 제한 적용
  - 문제 생성: 역사 과목 (MVP)
  - 테마: 4가지 테마 + 반응형 Safe Area
  - 인증: JWT 토큰 + expo-secure-store
  - 사용량: 플랜별 월간 제한 (Free 10회)
  - 교육과정 DB: 2015 개정 384개 + 2022 개정 210개 = 594개
    - 2015 개정: 중학교 240 + 고1 144 = 384개
    - 2022 개정: 중3(수학15+국어45+영어34) + 고1(공통수학37+통합사회29+통합과학28+한국사22) = 210개

다음 세션 작업 계획:

  🔴 우선순위 1: 문제 생성 기능 확장
    ✅ 역사 과목 문제 생성 완료
    □ 다른 과목 확장 (수학, 과학, 사회)
    □ 취약 개념 추적 개선

  🟠 우선순위 2: V2 기능
    □ 정리법 사용자 생성
    □ 오답노트 V2

  🟡 우선순위 3: 스토어 출시 준비
    □ 스토어 스크린샷 촬영
    □ Google Play Console 설정
    □ 실제 인앱결제 연동


═══════════════════════════════════════════════════════════════
