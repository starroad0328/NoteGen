═══════════════════════════════════════════════════════════════
                    NoteGen 개발 메모
═══════════════════════════════════════════════════════════════

최종 업데이트: 2025년 12월 21일


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 현재 상태
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

진행도: 100% (핵심 기능 완료)

완료된 작업:
  ✅ 프로젝트 기획 및 문서화
  ✅ Backend API 구현 (FastAPI)
  ✅ Mobile App UI 구현 (React Native + Expo)
  ✅ AI 모델 가격 정책 수립
  ✅ 데이터베이스 모델 설계
  ✅ CLOVA OCR API 통합 (네이버 클라우드)
  ✅ OCR bbox + confidence 메타데이터 저장
  ✅ Expo SDK 54 업그레이드
  ✅ 백엔드-모바일 연동 테스트
  ✅ GPT-5 mini AI 정리 통합
  ✅ OpenAI API 연동 완료
  ✅ 3단계 AI 파이프라인 구현 (OCR정제 → 구조파악 → 정리)
  ✅ OCR 블록 압축 (토큰 절약)
  ✅ 폴링 에러 처리 개선
  ✅ OCR 정제 LLM (GPT-5 nano) 추가
  ✅ AI 단계별 진행 상태 표시
  ✅ 노트 복사 버튼 추가

완료된 추가 작업:
  ✅ 로그인/회원가입 기능 (JWT 인증)
  ✅ 학년 선택 UI (중/고 1~3학년)
  ✅ 교육과정 데이터 (2022 개정 기준)
  ✅ AI 프롬프트에 학년/교육과정 반영
  ✅ 교육과정 DB 스키마 설계 (Subject, Domain, AchievementStandard)
  ✅ 중학교 수학 성취기준 61개 입력 (2015 개정)

현재 브랜치: main


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 다음 세션 시작 전 필요사항
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

필수:
  ✅ CLOVA OCR API 설정 완료
    → Secret Key, Invoke URL 설정됨

  □ OpenAI API Key 발급 (AI 정리 기능용)
    → https://platform.openai.com/api-keys
    → backend/.env에 OPENAI_API_KEY 입력 필요

선택:
  □ Google Cloud Vision API (이중 OCR용)
  □ Android Studio (에뮬레이터 테스트)


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 빠른 실행 명령어
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Backend 실행:
  cd backend
  pip install -r requirements.txt
  uvicorn app.main:app --reload
  → http://localhost:8000/docs

Mobile App 실행:
  cd mobile
  npm install
  npx expo start
  → Expo Go 앱으로 QR 스캔


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 알려진 이슈
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. CLOVA OCR 사용 중
   - Google Vision, Tesseract는 미사용
   - 한글 손글씨 인식에 CLOVA가 최적

2. OCR 메타데이터 저장
   - bbox, confidence 정상 저장됨 (JSON 형식)
   - 이중 JSON 인코딩 이슈 해결됨

3. Expo SDK 54 사용
   - expo-linking 추가 설치 필요
   - React Native 0.81.5, React 19.1.0

4. Windows 인코딩 이슈
   - emoji 제거로 해결
   - cp949 codec 에러 방지


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 최근 개발 내역 (2025-12-21)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ OCR 정제 LLM 단계 추가 (0단계)
  - GPT-5 nano를 활용한 텍스트 정제
  - 띄어쓰기 복원, 잘린 글자 합치기
  - 3단계 파이프라인: 정제 → 구조 분석 → 정리

✅ 블록 메타데이터 출력 제거
  - [bX] (y:XX) 형식이 결과에 출력되던 문제 해결
  - 깔끔한 마크다운으로만 출력되도록 프롬프트 수정

✅ AI 단계별 진행 상태 표시
  - on_step 콜백으로 DB에 progress_message 저장
  - [1/3], [2/3], [3/3] 형식으로 단계 표시
  - Note 모델에 progress_message 필드 추가

✅ 노트 복사 버튼 추가
  - expo-clipboard 설치
  - 정리된 내용 클립보드 복사 기능

✅ 폴링 간격 최적화
  - 2초 → 0.8초로 변경


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 현재 AI 파이프라인
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

이미지 업로드
    ↓
CLOVA OCR (텍스트 + bbox 추출)
    ↓
0단계: OCR 정제 (GPT-5 nano, 3000 토큰)
    ↓
1단계: 구조 파악 (GPT-5 mini, 3000 토큰)
    ↓
2단계: 정리 생성 (GPT-5 mini, 6000 토큰)
    ↓
결과 반환

[TODO] 다음 단계: 성취기준 매핑 파이프라인 추가
    - 필기 내용 → 성취기준 코드 매핑
    - 학년/과목별 관련 성취기준 표시
    - 나머지 과목 성취기준 데이터 추가 필요 (국어, 영어, 사회, 과학)


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 GitHub 정보
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

저장소: https://github.com/starroad0328/NoteGen
브랜치: main
최신 커밋: 7965db9 (feat: 교육과정 DB 스키마 및 중학교 수학 성취기준 추가)
이전 커밋: 5dab408 (feat: 로그인/회원가입 + 학년별 교육과정 기능 추가)


═══════════════════════════════════════════════════════════════


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 AI 프롬프트 원본 (백업)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[ 기본 요약 정리 프롬프트 - 원본 (GPT-5/5-mini용) ]

다음 필기 내용을 '기본 요약 정리' 형식으로 정리해주세요.

[정리 규칙]
1. 제목을 자동으로 생성하세요 (내용을 기반으로)
2. 소제목으로 내용을 구분하세요
3. 각 소제목 아래에 글머리표(•)를 사용하여 요약하세요
4. 중요한 개념은 ⭐ 표시를 추가하세요
5. 강조할 내용은 🔸 표시를 추가하세요
6. 마크다운 형식으로 작성하세요

[출력 형식]
# [제목]

## [소제목 1]
• 요약 내용 1
• ⭐ 중요 개념
• 요약 내용 2

## [소제목 2]
• 🔸 강조 내용
• 요약 내용

[필기 원문]
{ocr_text}

위 내용을 기본 요약 정리 형식으로 정리해주세요:


[ 코넬식 정리 프롬프트 - 원본 (GPT-5/5-mini용) ]

다음 필기 내용을 '코넬식 노트' 형식으로 정리해주세요.

[정리 규칙]
1. 제목을 자동으로 생성하세요
2. 좌측 키워드: 핵심 개념을 질문형으로 ("~란?", "~의 특징은?")
3. 우측 본문: 개념을 명확하게 설명
4. 하단 요약: 전체 내용을 1문장으로 압축
5. 중요한 개념은 ⭐ 표시
6. 마크다운 형식으로 작성하세요

[출력 형식]
# [제목]

## 📝 노트 내용

| 키워드/질문 | 설명 |
|------------|------|
| ⭐ [핵심 개념]이란? | [명확한 설명] |
| [관련 개념]의 특징은? | [특징 설명] |

---

**📌 요약**
[전체 내용을 1문장으로 압축한 요약]

[필기 원문]
{ocr_text}

위 내용을 코넬식 노트 형식으로 정리해주세요:


═══════════════════════════════════════════════════════════════


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 작업 종료 메모 (2025-12-21)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

오늘 완료한 작업:
  ✅ OCR 정제 LLM 추가 (GPT-5 nano, 0단계)
  ✅ 블록 메타데이터 출력 제거
  ✅ AI 단계별 진행 상태 표시
  ✅ 노트 복사 버튼 추가 (expo-clipboard)
  ✅ 폴링 간격 최적화 (0.8초)
  ✅ 로그인/회원가입 기능 (JWT + bcrypt)
  ✅ 학년 선택 UI (중/고 1~3학년)
  ✅ 교육과정 데이터 (2022 개정 기준)
  ✅ AI 프롬프트에 학년/교육과정 컨텍스트 주입
  ✅ 교육과정 DB 스키마 설계 완료
  ✅ 중학교 수학 성취기준 61개 입력 (2015 개정)
  ✅ 교육과정 조회 API 구현

현재 상태:
  - 백엔드 서버: 정상 작동
  - 모바일 앱: 정상 작동
  - OCR: CLOVA OCR 사용 중
  - AI: 3단계 파이프라인 (정제→구조→정리)
  - 인증: JWT 토큰 + expo-secure-store
  - 교육과정 DB: 수학 성취기준 61개 (중1~3)

새로 추가된 파일:
  Backend:
    - app/models/base.py (공유 Base)
    - app/models/curriculum.py (교육과정 DB 모델)
    - app/services/auth_service.py (JWT, 해싱)
    - app/schemas/auth.py (인증 스키마)
    - app/api/auth.py (인증 API)
    - app/api/curriculum.py (교육과정 API)
    - app/core/curriculum.py (교육과정 하드코딩 - 레거시)
    - app/core/seed_curriculum.py (DB 시드)
  Mobile:
    - contexts/AuthContext.tsx (인증 상태)
    - app/login.tsx (로그인)
    - app/register.tsx (회원가입 + 학년선택)

다음 세션 작업 계획:
  🔴 우선순위 1: 나머지 과목 성취기준 추가
    - 국어 성취기준 (NCIC에서 추출)
    - 영어 성취기준
    - 사회 성취기준
    - 과학 성취기준

  🟡 우선순위 2: 성취기준 매핑 파이프라인
    - 필기 → 성취기준 코드 자동 매핑
    - AI 프롬프트에 관련 성취기준 주입


═══════════════════════════════════════════════════════════════
