═══════════════════════════════════════════════════════════════
                    NoteGen 개발 메모
═══════════════════════════════════════════════════════════════

최종 업데이트: 2025년 12월 19일


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 현재 상태
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

진행도: 99%

완료된 작업:
  ✅ 프로젝트 기획 및 문서화
  ✅ Backend API 구현 (FastAPI)
  ✅ Mobile App UI 구현 (React Native + Expo)
  ✅ AI 모델 가격 정책 수립
  ✅ 데이터베이스 모델 설계
  ✅ CLOVA OCR API 통합 (네이버 클라우드)
  ✅ OCR bbox + confidence 메타데이터 저장
  ✅ Expo SDK 54 업그레이드
  ✅ 백엔드-모바일 연동 테스트
  ✅ GPT-5 mini AI 정리 통합
  ✅ OpenAI API 연동 완료
  ✅ 2단계 AI 파이프라인 구현 (구조 파악 → 정리)
  ✅ OCR 블록 압축 (토큰 절약)
  ✅ 폴링 에러 처리 개선

대기 중인 작업:
  ⏳ Vision AI 통합 (이미지 + OCR + bbox 활용)
  ⏳ 대량 테스트 및 품질 검증


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 다음 세션 시작 전 필요사항
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

필수:
  ✅ CLOVA OCR API 설정 완료
    → Secret Key, Invoke URL 설정됨

  □ OpenAI API Key 발급 (AI 정리 기능용)
    → https://platform.openai.com/api-keys
    → backend/.env에 OPENAI_API_KEY 입력 필요

선택:
  □ Google Cloud Vision API (이중 OCR용)
  □ Android Studio (에뮬레이터 테스트)


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 빠른 실행 명령어
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Backend 실행:
  cd backend
  pip install -r requirements.txt
  uvicorn app.main:app --reload
  → http://localhost:8000/docs

Mobile App 실행:
  cd mobile
  npm install
  npx expo start
  → Expo Go 앱으로 QR 스캔


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 알려진 이슈
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. CLOVA OCR 사용 중
   - Google Vision, Tesseract는 미사용
   - 한글 손글씨 인식에 CLOVA가 최적

2. OCR 메타데이터 저장
   - bbox, confidence 정상 저장됨 (JSON 형식)
   - 이중 JSON 인코딩 이슈 해결됨

3. Expo SDK 54 사용
   - expo-linking 추가 설치 필요
   - React Native 0.81.5, React 19.1.0

4. Windows 인코딩 이슈
   - emoji 제거로 해결
   - cp949 codec 에러 방지


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 최근 개발 내역 (2025-12-19)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 2단계 AI 파이프라인 구현
  - 1단계: 구조 파악 (목차, 주제 분류) - 3000 토큰
  - 2단계: 원본 유지 + 보강 정리 - 6000 토큰
  - GPT-5 mini 토큰 한도 문제 해결

✅ OCR 블록 압축 구현
  - 글자/단어 → 줄(Line) → 블록(Block)
  - y 중심값 기준 같은 줄 판정
  - 좌표 0~1000 정규화
  - 토큰 사용량 대폭 절약

✅ 폴링 에러 처리 개선
  - setInterval → setTimeout 변경
  - isMountedRef로 언마운트 후 상태 업데이트 방지
  - 지수 백오프 재시도 (최대 5회)
  - Network Error 스팸 방지

✅ 코드 정리
  - AIModel.GPT_5_NANO → GPT_5_MINI 수정
  - 디버그 로그 정리
  - __pycache__ 캐시 이슈 해결


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 GitHub 정보
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

저장소: https://github.com/starroad0328/NoteGen
브랜치: main
최신 커밋: 80fb48e (fix: 폴링 에러 처리 개선)
이전 커밋: fa36f1f (feat: AI 정리 파이프라인 개선)


═══════════════════════════════════════════════════════════════


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 AI 프롬프트 원본 (백업)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[ 기본 요약 정리 프롬프트 - 원본 (GPT-5/5-mini용) ]

다음 필기 내용을 '기본 요약 정리' 형식으로 정리해주세요.

[정리 규칙]
1. 제목을 자동으로 생성하세요 (내용을 기반으로)
2. 소제목으로 내용을 구분하세요
3. 각 소제목 아래에 글머리표(•)를 사용하여 요약하세요
4. 중요한 개념은 ⭐ 표시를 추가하세요
5. 강조할 내용은 🔸 표시를 추가하세요
6. 마크다운 형식으로 작성하세요

[출력 형식]
# [제목]

## [소제목 1]
• 요약 내용 1
• ⭐ 중요 개념
• 요약 내용 2

## [소제목 2]
• 🔸 강조 내용
• 요약 내용

[필기 원문]
{ocr_text}

위 내용을 기본 요약 정리 형식으로 정리해주세요:


[ 코넬식 정리 프롬프트 - 원본 (GPT-5/5-mini용) ]

다음 필기 내용을 '코넬식 노트' 형식으로 정리해주세요.

[정리 규칙]
1. 제목을 자동으로 생성하세요
2. 좌측 키워드: 핵심 개념을 질문형으로 ("~란?", "~의 특징은?")
3. 우측 본문: 개념을 명확하게 설명
4. 하단 요약: 전체 내용을 1문장으로 압축
5. 중요한 개념은 ⭐ 표시
6. 마크다운 형식으로 작성하세요

[출력 형식]
# [제목]

## 📝 노트 내용

| 키워드/질문 | 설명 |
|------------|------|
| ⭐ [핵심 개념]이란? | [명확한 설명] |
| [관련 개념]의 특징은? | [특징 설명] |

---

**📌 요약**
[전체 내용을 1문장으로 압축한 요약]

[필기 원문]
{ocr_text}

위 내용을 코넬식 노트 형식으로 정리해주세요:


═══════════════════════════════════════════════════════════════


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 작업 종료 메모 (2025-12-19)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

오늘 완료한 작업:
  ✅ 2단계 AI 파이프라인 구현 (구조 파악 → 정리)
  ✅ OCR 블록 압축 (토큰 절약)
  ✅ GPT-5 mini 토큰 한도 문제 해결
  ✅ 폴링 에러 처리 개선 (재시도 로직, 언마운트 정리)
  ✅ 메인 브랜치 머지 및 푸시

현재 상태:
  - 백엔드 서버: 정상 작동
  - 모바일 앱: 정상 작동
  - OCR: CLOVA OCR 사용 중
  - AI: GPT-5 mini (2단계 파이프라인)
  - 토큰: 1단계 3000, 2단계 6000

해결된 이슈:
  ✅ GPT-5 mini 토큰 한도 초과
    - 해결: 2단계 처리 + 블록 압축
  ✅ Network Error 스팸
    - 해결: 지수 백오프 재시도 (최대 5회)

다음 세션 작업 계획:
  🔴 우선순위 1: Vision AI 통합
    - 이미지 + OCR + bbox를 Vision API로 전달
    - 그림/도표/화살표 인식
    - 공간적 구조 파악

  🟡 우선순위 2: 대량 테스트
    - 실제 필기 사진 여러 장 테스트
    - OCR 정확도 검증
    - AI 정리 품질 평가


═══════════════════════════════════════════════════════════════
